# 云存储架构

## 云存储的相关概念

### 定义

现在，越来越多的企业采用云存储选项，因为更大的容量、弹性容量和更好的方式来管理存储成本是企业的需求。云存储是是一个远程平台，通过高度虚拟化的多租户基础设施为企业供应可扩展的存储资源，可根据组织的要求动态配置。云存储也是一种网上在线存储的模式，即把数据存放在通常由第三方托管的多台虚拟服务器，而非专属的服务器上。云存储不是指某一个具体的设备，而是指一个由许许多多个存储设备和服务器所构成的集合体。使用者使用云存储，并不是使用某一个存储设备，而是使用整个云存储系统带来的一种数据访问服务。云存储的核心是应用软件与存储设备相结合，通过应用软件来实现存储设备向存储服务的转变。云存储就是将储存资源放到网络上供人存取的一种新兴方案。使用者可以在任何时间、任何地方，透过任何可连网的装置方便地存取数据。托管公司运营大型的数据中心，需要数据存储托管的人，则透过向其购买或租赁存储空间的方式，来满足数据存储的需求。数据中心营运商根据客户的需求，在后端准备存储虚拟化的资源，并将其以存储资源池的方式提供，客户便可自行使用此存储资源池来存放文件或对象。实际上，这些资源可能被分布在众多的服务器主机上。

从狭义上来说，云存储是指通过虚拟化、分布式技术、集群应用、网格技术、负载均衡等技术，将网络中大量的存储设备通过软件集合起来高效协同工作，共同对外提供低成本**、**高扩展性的数据存储服务。从广义上来讲，云存储可以理解为按需提供的虚拟存储资源，如同云计算的Paas、Iaas服务一样，可称为数据存储即服务，即基于指定的服务水平请求，通过网络提供适当的虚拟存储和相关数据服务。

### 特点

在云时代，人类与云的距离不再需要仰望天空，只用鼠标轻点指尖滑动。云端之上不再是神明的代表词，而是数字与代码组成的另一片天地。云存储是顺应时代的产物，人类自互联网普及以来的需求越来越大，从最初的拍照，到音频、视频，还有各种数据信息，人类创造与分享数据的热情空前高涨，移动互联网的发展，也是一个加剧存储方式变革的诱因。在这场变革中，首先被冲击的就是传统硬盘，传统硬盘存储可使用空间小，和移动设备一荣俱荣、一损俱损，而安全性更加的满足不了人们的需求了。伴随着需求，更安全与便捷的云存储登上了舞台。

1、可扩展性

不同于传统的存储方式，云存储具有高可扩展性。云存储系统可支持海量数据处理，资源可以实现按需扩展。传统存储系统以及横向扩展增加的节点，对容量、性能以及（如在NAS中的）文件和对象都有大的限制。因此，更多存储系统会根据数据的规模进行部署需要更多备份、数据归档、管理任务和管理人员。云存储提供商可以通过向云添加新的节点，提供更多容量和对象，并增强性能，从而缓解此类问题。云存储不需要管理所有数据的单个或聚合命名空间。相反，它使用一个更松散的独立的数据元素联合。这消除了对整个系统的高速缓存一致性的需求，也就是每个节点需要知道其他节点拥有的对象以及物理节点对一条数据的所有权。因此云存储是基于关于数据本身的规则，而不是系统的数据规模。只要数据满足指定的策略，即需要拥有多少副本以及它可以保存在什么位置，系统几乎可以无限期地增长和扩展。

2、灵活性

有限的元数据是大多数存储系统的缺点。确实，NAS系统比SAN或DAS系统拥有更多的元数据，但它仍然是有限的。元数据的缺乏限制了哪些部分可以实现自动化。在这个层面上，云计算和云存储的优势再度发挥了作用。云存储可容纳更多元数据，并为特定业务和系统功能的数据提供出色的自定义控制。反过来，可以根据策略触发器操作数据并按规则进行扩展。这些规则可自动执行许多传统的手动密集型任务，例如分层存储、安全性、迁移、冗余和删除等。多云方法为企业云战略增加了另一层灵活性。特别是，它消除了供应商锁定的威胁，在各种环境中提供更大的可移植性。通过多云策略，可以更快、更轻松地将应用程序和数据从本地存储迁移到云以及从一个云移动到另一个云。

3、多租户

传统的存储系统及其横向扩展新增的节点从未设计用于多租户。安全性、计费和退款都是固定的，而不是内置的。云存储的一个显着优势是自定义元数据提供了前所未有的安全层，每个对象或文件都充当自主数据实例，为不同方提供广泛的受控和受限访问策略。在动态和静态时提供内置加密。

4、没有破坏性数据迁移

因为云存储基于对象存储，所以它的一个优点是可以消除技术更新周期导致的破坏性数据迁移，并使技术更新成为一项简单的在线任务。这是通过向系统添加新节点（例如SSD）来完成的。立即发现并使用这些新节点，同时在需要时退出旧节点。退役节点上的数据只是在其他地方重新创建。这样可以在升级过程中去除停机时间和服务器修复。

5、减少灾难恢复成本

云存储完全改变了灾难恢复（DR）成本极高的现状，因为不需要额外的数据中心。数据和应用程序可以自动从私有云复制到公有云或多个公有云，理想的情况是将关键数据和资源放在一个云上，并将它们复制到地理位置不同的其他提供商的云中。如果一个云服务提供商遇到全球性故障，其他云就可以接入。这样不但能解决成本问题，还能提高可靠性和安全性。

云和多云存储拥有很多优势，但也存在挑战。但总体来说，云存储的优势仍是非常明显的。

### 分类

有句俗话，一鞋不能适千足。应用在不同的云服务环境，云存储有不同的种类。

从数据的存储和访问的方式来区分，云存储包括数据块级云存储、文件级云存储和对象级云存储。这三种类型是由存储局域网(SAN)、网络附加存储(NAS)和内容访问存储(CAS)分别发展而来。

数据块级云存储指提供高速的直接的数据块存储访问服务。前端的计算节点通过光纤网络访问协议访问存储，获得高速、稳定、有保障的数据访问。这种模型源于在关键业务系统中久经验证的存储局域网SAN模型。不过在云存储的时代，改为分布式的并行扩展模式，并增加了以上讨论的其它云存储特征。由于此模型采用的是高带宽、低延迟、可靠的光纤网络存储访问协议，前端计算节点独享或少量共享存储内容的数据结构，因此，和前端的计算节点是属于紧耦合的关系，性能是最优的。

文件级云存储通过网络文件系统访问协议提供文件级的存储访问服务。这种模型源于网络附加存储NAS的模型，计算节点通过以太网的协议，在其上构建区域内相对快速、安全、可靠的网络文件系统来获得文件的访问服务。不过在云存储的时代，文件级云存储突破了传统NAS访问空间的局限，提供了高达PB级的全局命名空间的访问能力，和以上讨论的其它云存储特征。这种模型和前端节点是C/S的模型，二者采用树状的文件系统结构来存储和访问数据，属于中耦合的关系，在区域内性能有足够的保证。

对象级云存储通过广域网的面向对象的访问协议来获取对象级的存储访问服务。对象和文件既有相似之处，也有区别。对象通常改动较少，并且拥有许多的属性，而且为多租户使用。这种模型源自于早期EMC推出的CAS存储系统。但是，在云存储时代，突破了访问地域的限制，借助于面向对象的访问协议，用户可以在全球任何地点访问对象级存储云中储存的对象内容。对象级云存储面向的是海量的各种尺寸、不同格式的对象内容，为提高访问效率，前端计算节点并不关心对象级云存储内部的存储方法和数据结构的模型。属于松耦合的关系。

从云存储供应商和用户的关系，云存储包括个人云存储、公共云存储、私有云存储和混合云存储。

个人云存储也被称为移动云存储，每个个体用户都可以拥有自己的个人云，可以将个人信息存储在上面。用户在任何时间和地点都可以访问自己的个人云。在公共云存储中，企业和云存储服务提供商是独立的。通常是为了简化管理，企业在他们的数据中心没有云资源，云服务完全由云服务提供商管理。私有云存储具有集成在企业数据中心中的企业和云服务提供商。 存储提供商已在企业数据中心内获得了基础架构，该基础架构再次由存储提供商在私有云存储中进行管理。 用户将获得相当有保证的安全服务，并且在私有云服务中还有望获得令人满意的性能。私有云存储和公共云存储的组合被称为混合云存储。 最重要的数据保存在企业的私有云中，不是很重要的数据将其放置在公共云存储提供商内部。

### 与云计算关系

云存储是在云计算概念上延伸和发展出来的一个新的概念，是指通过集群应用、网格技术或分布式文件系统等功能，将网络中大量各种不同类型的存储设备通过应用软件集合起来协同工作，共同对外提供数据存储和业务访问功能的一个系统。当云计算系统运算和处理的核心是大量数据的存储和管理时，云计算系统中就需要配置大量的存储设备，那么云计算系统就转变成为一个云存储系统，所以云存储是一个以数据存储和管理为核心的云计算系统。

就如同云状的广域网和互联网一样，云存储对使用者来讲，不是指某一个具体的设备，而是指一个由许许多多个存储设备和服务器所构成的集合体。使用者使用云存储，并不是使用某一个存储设备，而是使用整个云存储系统带来的一种数据访问服务。所以严格来讲，云存储不是存储，而是一种服务。

从两者的关系来看，云存储和云计算之间的关系还是很好理解的，云存储和云计算相比较，可以认为是云存储配置了大容量存储空间的一个云计算系统。未来云计算的应用会更加细致的深入到我们日常的生活中去，未来基于云计算的云存储会更加的深入到目前的移动互联行业，而我们现在的智能有手机在未来将有一个具有大容量云端存储，正如前面所说的，云存储不是实物，是服务，未来市场潜力巨大。

## 云存储的结构模型

基于云存储的特点，云存储平台整体架构可划分为四个层次，自底向上依次是：存储层、基础管理层、应用接口层以及访问层。

1、存储层

存储层是云存储最基础的部分。云存储系统对外提供多种不同的存储服务，各种服务的数据统一存放在云存储系统中，形成一个海量数据池。从大多数网络服务后台数据组织方式来看，传统基于单服务器的数据组织难以满足广域网多用户条件下的吞吐性能和存储容量需求；基于P2P架构的数据组织需要庞大的节点数量和复杂编码算法保证数据可靠性。相比而言，基于多存储服务器的数据组织方法能够更好满足在线存储服务的应用需求，在用户规模较大时，构建分布式数据中心能够为不同地理区域的用户提供更好的服务质量。

云存储的存储层将不同类型的存储设备互连起来，实现海量数据的统一管理，同时实现对存储设备的集中管理、状态监控以及容量的动态扩展，实质是一种面向服务的分布式存储系统。存储设备可以是FC光纤通道存储设备，可以是NAS和iSCSI等IP存储设备，也可以是SCSI或SAS等DAS存储设备。存储设备之上是一个统一存储设备管理系统，可以实现存储设备的逻辑虚拟化管理、多链路冗余管理，以及硬件设备的状态监控和故障维护。

2、基础管理层

基础管理层是云存储最核心的部分，也是云存储中最难以实现的部分。基础管理层通过集群、分布式文件系统和网格计算等技术，实现云存储中多个存储设备之间的协同工作，使多个的存储设备可以对外提供同一种服务，并提供更大、更强、更好的数据访问性能。

CDN内容分发系统、数据加密技术保证云存储中的数据不会被未授权的用户所访问，同时，通过各种数据备份、容灾技术和措施可以保证云存储中的数据不会丢失，保证云存储自身的安全和稳定。

3、应用接口层

应用接口层是云存储平台中可以灵活扩展的、直接面向用户的部分。根据用户需求，可以开发出不同的应用接口，提供相应的服务。比如数据存储服务、空间租赁服务、公共资源服务、多用户数据共享服务、数据备份服务等。

4、访问层

通过访问层，任何一个授权用户都可以在任何地方，使用一台联网的终端设备，按照标准的公用应用接口来登录云存储平台，享受云存储服务。云存储运营单位不同，云存储提供的访问类型和访问手段也不同。

## 云存储的架构



架构方法分为两类：一种是通过服务来架构;另一种是通过软件或硬件设备来架构。传统的系统利用紧耦合对称架构,这种架构的设计旨在解决HPC(高性能计算、超级运算)问题,现在其正在向外扩展成为云存储从而满足快速呈现的市场需求。下一代架构已经采用了松弛耦合非对称架构,集中元数据和控制操作,这种架构并不特别适合高性能HPC,但是这种设计旨在解决云部署的大容量存储需求。 

1、紧耦合对称架构（TCS）

构建TCS系统是为了解决单一文件性能所面临的挑战,这种挑战限制了传统NAS系统的发展。HPC系统所具有的优势迅速压倒了存储,因为它们需要的单一文件I/O操作要比单一设备的I/O操作多得多。业内对此的回应是创建利用TCS
架构的产品,很多节点同时伴随着分布式锁管理(锁定文件不同部分的写操作)和缓存一致性功能。这种解决方案对于单文件吞吐量问题很有效,几个不同行业的很多HPC客户已经采用了这种解决方案。这种解决方案很先进,需要一定程度的技术经验才能安装和使用。

2、松弛耦合非对称架构(LCA)

LCA系统采用不同的方法来向外扩展。它不是通过执行某个策略来使每个节点知道每个行动所执行的操作,而是利用一个数据路径之外的中央元数据控制服务器。集中控制提供了很多好处,允许进行新层次的扩展:存储节点可以将重点放在提供读写服务的要 求上,而不需要来自网络节点的确认信息；节点可以利用不同的商品硬件CPU和存储配 置,而且仍然在云存储中发挥作用。用户可以通过利用硬件性能或虚拟化实例来调整云存储；消除节点之间共享的大量状态开销也可以消除用户计算机互联的需要,如光纤通道或 infiniband,从而进一步降低成本；异构硬件的混合和匹配使用户能够在需要的时候在当前经济规模的基础上扩大存储,同时还能提供永久的数据可用性；拥有集中元数据意味着,存储节点可以旋转地进行深层次应用程序归档,而且在控制节点上,元数据经常都是可用的。

## 云存储的关键技术

1、存储虚拟化

通过存储虚拟化方法，把不同厂商、不同型号、不同通信技术、不同类型的存储设备互联起来，将系统中各种异构的存储设备映射为一个统一的存储资源池。存储虚拟化技术能够对存储资源进行统一分配管理，又可以屏蔽存储实体间的物理位置以及异构特性，实现了资源对用户的透明性，降低了构建、管理和维护资源的成本，从而提升云存储系统的资源利用率。存储虚拟化技术虽然不同设备与厂商之间略有区别，但从总体来说，可概括为基于主机虚拟化、基于存储设备虚拟化和基于存储网络虚拟化三种技术。

2、分布式存储技术

目前比较流行的分布式存储技术为：分布式块存储、分布式文件系统存储、分布式对象存储和分布式表存储。分布式存储是通过网络使用服务商提供的各个存储设备上的存储空间，并将这些分散的存储资源构成一个虚拟的存储设备，数据分散的存储在各个存储设备上。

3、数据缩减技术

比较流行的数据缩减技术包括：自动精简配置、自动存储分层、重复数据删除、数据压缩。为应对数据存储的急剧膨胀，企业需要不断购置大量的存储设备来满足不断增长的存储需求。权威机构研究发现，企业购买了大量的存储设备，但是利用率往往不足50%，存储投资回报率水平较低。通过云存储技术不仅解决了存储中的高安全性、可靠性、可扩展、易管理等存储的基本要求，同时也利用云存储中的数据缩减技术，满足海量信息爆炸式增长趋势，一定程度上节约企业存储成本，提高效率。

4、数据备份技术

在以数据为中心的时代，数据的重要性无可置否，如何保护数据是一个永恒的话题，即便是现在的云存储发展时代，数据备份技术也非常重要。数据备份技术是将数据本身或者其中的部分在某一时间的状态以特定的格式保存下来，以备原数据出现错误、被误删除、恶意加密等各种原因不可用时，可快速准确的将数据进行恢复的技术。数据备份是容灾的基础，是为防止突发事故而采取的一种数据保护措施，根本目的是数据资源重新利用和保护，核心的工作是数据恢复。

5、内容分发网络技术

内容分发网络是一种新型网络构建模式，主要是针对现有的Internet进行改造。基本思想是尽量避开互联网上由于网络带宽小、网点分布不均、用户访问量大等影响数据传输速度和稳定性的弊端，使数据传输的更快、更稳定。通过在网络各处放置节点服务器，在现有互联网的基础之上构成一层智能虚拟网络，实时地根据网络流量、各节点的连接和负载情况、响应时间、到用户的距离等信息将用户的请求重新导向离用户最近的服务节点上。

6、存储加密技术

存储加密是指当数据从前端服务器输出，或在写进存储设备之前通过系统为数据加密，以保证存放在存储设备上的数据只有授权用户才能读取。目前云存储中常用的存储加密技术有以下几种：全盘加密，全部存储数据都是以密文形式书写的;虚拟磁盘加密，存放数据之前建立加密的磁盘空间，并通过加密磁盘空间对数据进行加密;卷加密，所有用户和系统文件都被加密;文件/目录加密，对单个的文件或者目录进行加密。